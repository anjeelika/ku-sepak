{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>KuSepak!</title>
{% endblock meta %}

{% block content %}
{% include 'navbar.html' %}
<div class="bg-gray-50 w-full pt-16 min-h-screen">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Filter Section -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8 bg-white rounded-lg border border-gray-200 p-4">
      <div class="flex space-x-3 mb-4 sm:mb-0">
        <button id="filter-all"
          class="px-4 py-2 rounded-md font-medium transition-colors bg-[#be7919] text-white hover:bg-[#a45b19] hover:text-white">
          All Products
        </button>
        <button id="filter-my"
          class="px-4 py-2 rounded-md font-medium transition-colors bg-white text-gray-700 border border-gray-300 hover:bg-[#be7919] hover:text-white">
          My Products
        </button>
      </div>
      {% if user.is_authenticated %}
      <div class="flex items-center space-x-3">
        <button id="btn-refresh"
          class="px-4 py-2 bg-[#be7919] text-white rounded-md hover:bg-[#a45b19] transition-colors">
          Refresh
        </button>
        <div class="text-sm text-gray-500">
          Last login: {{ last_login }}
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Button Create Product -->
    {% if user.is_authenticated %}
    <div class="flex justify-end mb-6">
      <button id="btn-create"
        class="px-4 py-2 bg-[#be7919] text-white rounded-md hover:bg-[#a45b19] transition-colors">
        + Add Product
      </button>
    </div>
    {% endif %}

    <!-- Product Container (AJAX rendered) -->
    <div id="product-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- JS will render cards here -->
    </div>

    <!-- Loading, Empty, and Error States -->
    <div id="loading-state" class="hidden text-center py-12 text-gray-500">Loading products...</div>
    <div id="empty-state" class="hidden text-center py-12 text-gray-500">
      <img src="{% static 'image/no-products.png' %}" alt="No products" class="w-32 h-32 mx-auto mb-3">
      <p>No products found.</p>
    </div>
    <div id="error-state" class="hidden text-center py-12 text-red-500">Failed to load products. Please try again.</div>

  </div>
</div>

<!-- Modal: Create/Edit Product -->
<div id="modal-product" class="fixed inset-0 bg-black bg-opacity-50 hidden items-start justify-center z-50 p-4 sm:p-6 overflow-y-auto">
  <div class="relative bg-white rounded-lg border border-gray-200 w-11/12 sm:w-2/3 lg:w-1/2 max-w-3xl mx-auto my-8 form-style">
    <div class="p-6 sm:p-8">
      <!-- Header -->
      <div class="mb-8">
        <h1 id="modal-title" class="text-2xl font-bold text-gray-900 mb-2">Create Product</h1>
        <p class="text-gray-600" id="modal-subtitle">Add a new product to your store</p>
      </div>
      
      <form onsubmit="return handleSubmit(event)" class="space-y-6">
        <input type="hidden" id="product-id">
        
        <!-- Name -->
        <div>
          <label for="product-name" class="block text-sm font-medium text-gray-700 mb-2">Name</label>
          <div class="w-full">
            <input id="product-name" 
                   type="text" 
                   required 
                   placeholder="Enter product name"
                   class="w-full rounded-md border-gray-300 shadow-sm focus:border-[#be7919] focus:ring focus:ring-[#be7919] focus:ring-opacity-20 transition-colors">
          </div>
        </div>

        <!-- Price & Stock -->
        <div class="grid grid-cols-2 gap-6">
          <div>
            <label for="product-price" class="block text-sm font-medium text-gray-700 mb-2">Price</label>
            <div class="w-full">
              <input id="product-price" 
                     type="number" 
                     min="0" 
                     required 
                     placeholder="Rp 0"
                     class="w-full rounded-md border-gray-300 shadow-sm focus:border-[#be7919] focus:ring focus:ring-[#be7919] focus:ring-opacity-20 transition-colors">
            </div>
          </div>
          <div>
            <label for="product-stock" class="block text-sm font-medium text-gray-700 mb-2">Stock</label>
            <div class="w-full">
              <input id="product-stock" 
                     type="number" 
                     min="0" 
                     required 
                     placeholder="0"
                     class="w-full rounded-md border-gray-300 shadow-sm focus:border-[#be7919] focus:ring focus:ring-[#be7919] focus:ring-opacity-20 transition-colors">
            </div>
          </div>
        </div>

        <!-- Description -->
        <div>
          <label for="product-description" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
          <div class="w-full">
            <textarea id="product-description" 
                      required 
                      rows="4"
                      placeholder="Enter product description"
                      class="w-full rounded-md border-gray-300 shadow-sm focus:border-[#be7919] focus:ring focus:ring-[#be7919] focus:ring-opacity-20 transition-colors"></textarea>
          </div>
        </div>

        <!-- Thumbnail URL -->
        <div>
          <label for="product-thumbnail" class="block text-sm font-medium text-gray-700 mb-2">Thumbnail URL</label>
          <div class="w-full">
            <input id="product-thumbnail" 
                   type="url" 
                   placeholder="https://"
                   class="w-full rounded-md border-gray-300 shadow-sm focus:border-[#be7919] focus:ring focus:ring-[#be7919] focus:ring-opacity-20 transition-colors">
          </div>
          <p class="mt-1 text-sm text-gray-500">Optional: Add an image URL for your product</p>
        </div>

        <!-- Category -->
        <div>
          <label for="product-category" class="block text-sm font-medium text-gray-700 mb-2">Category</label>
          <div class="w-full">
            <select id="product-category" 
                    required 
                    class="w-full rounded-md border-gray-300 shadow-sm focus:border-[#be7919] focus:ring focus:ring-[#be7919] focus:ring-opacity-20 transition-colors">
              <option value="ball">Ball</option>
              <option value="shoes">Shoes</option>
              <option value="jersey">Jersey & Apparel</option>
              <option value="accessories">Accessories</option>
              <option value="bag">Bags</option>
            </select>
          </div>
        </div>

        <!-- Featured -->
        <div class="flex items-center">
          <input id="product-featured" 
                 type="checkbox" 
                 class="rounded border-gray-300 text-[#be7919] focus:border-[#be7919] focus:ring focus:ring-[#be7919] focus:ring-opacity-20 transition-colors">
          <label for="product-featured" class="ml-2 text-sm text-gray-700">Featured product</label>
        </div>

        <!-- Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
          <button type="button" 
                  onclick="closeModal()"
                  class="order-2 sm:order-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-md font-medium hover:bg-gray-50 transition-colors text-center">
            Cancel
          </button>
          <button type="submit"
                  class="order-1 sm:order-2 flex-1 bg-[#be7919] text-white px-6 py-3 rounded-md font-medium hover:bg-[#a45b19] transition-colors">
            <span id="submit-text">Create Product</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal: Delete Confirmation -->
<div id="modal-delete" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-lg w-96 p-6 text-center">
    <h3 class="text-lg font-semibold mb-4">Are you sure you want to delete this product?</h3>
    <div class="flex justify-center space-x-4">
      <button id="btn-delete-cancel" class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100">
        Cancel
      </button>
      <button id="btn-delete-confirm"
        class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors">
        Delete
      </button>
    </div>
  </div>
</div>

{% endblock content %}